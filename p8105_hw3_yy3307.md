p8105_hw3_yy3307
================
Yang Yi
2022-10-07

# Problem 1

The first step we need to do is importing the `instacart` data from
`p8105.datasets`.

``` r
data("instacart")

instacart = 
  instacart %>% 
  as_tibble(instacart)
```

*The `Instacart` dataset contains data of online grovery services which
allow peopleto shop online from local stores. The dataset has 1384617
rows and 15 columns, which includes variables of
`order_id, product_id, add_to_cart_order, reordered, user_id, eval_set, order_number, order_dow, order_hour_of_day, days_since_prior_order, product_name, aisle_id, department_id, aisle, department`.
We can make some data analysis with this dataset, for instance, we can
indicate which type of grocery is most popular by counting frequencies
of `aisle` variable. Also, we can observe something like the
`reorder rate`, the `reorder rate` of this dataset is 0.5985944, which
means that about 59.86% of all customers would like to reorder.*

We can use `count` and `distinct` functions to find the total number of
aisles. And we also need to return the `name` of aisle which most
repeated being ordered, `which.max` can help us find that aisle. The
most occurrence aisle is easy to find, but we need to `filter` the aisle
column to eliminate the most occurrence aisle first and again use
`which.max` to find the second most occurrence aisle from the new list
of aisles.

``` r
num_aisle = count(distinct(instacart, aisle))

aisle_most = names(which.max(table(instacart$aisle)))

except_fresh =
  instacart %>%
  filter(!grepl('fresh vegetables', aisle))
aisle_2most = names(which.max(table(except_fresh$aisle)))
```

*There are **134** distinct aisles, **fresh vegetables** and **fresh
fruits** are the most items ordered from.*

To make a plot that we want, the first step is to manipulate our dataset
with conditions. In this condition, we need to `count` how many items
are ordered in each aisle and `filter` out how many of them has more
than 10000 items ordered. We can call `fct_reorder` from `forcats`
package to change the order level according to aisle name and number of
orders. Then, we can plot out the number of items ordered in each aisle
using `geom_point` with labels and themes being added. Lastly, we just
need to save the output plot into a `results` directory using `ggsave`.

``` r
reorder_aisle =
  instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, n))

numorder_aisle =
  ggplot(data = reorder_aisle, aes(x = aisle, y = n)) + 
  geom_point() + 
  labs(title = "Number of items ordered in each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

ggsave("./results/problem_1/aisle_orders.pdf", numorder_aisle, width = 8, height = 5)
numorder_aisle
```

<img src="p8105_hw3_yy3307_files/figure-gfm/plot_aisle-1.png" width="90%" />

Then we are going to make a table showing the top three popular items in
each of “baking ingredients”, “dog food care”, and “packaged vegetables
fruits” aisles. The table will include corresponding aisle, product
name, number of orders, and rank.

``` r
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(desc(n)) %>%
  knitr::kable()
```

| aisle                      | product_name                                  |    n | rank |
|:---------------------------|:----------------------------------------------|-----:|-----:|
| packaged vegetables fruits | Organic Baby Spinach                          | 9784 |    1 |
| packaged vegetables fruits | Organic Raspberries                           | 5546 |    2 |
| packaged vegetables fruits | Organic Blueberries                           | 4966 |    3 |
| baking ingredients         | Light Brown Sugar                             |  499 |    1 |
| baking ingredients         | Pure Baking Soda                              |  387 |    2 |
| baking ingredients         | Cane Sugar                                    |  336 |    3 |
| dog food care              | Snack Sticks Chicken & Rice Recipe Dog Treats |   30 |    1 |
| dog food care              | Organix Chicken & Brown Rice Recipe           |   28 |    2 |
| dog food care              | Small Dog Biscuits                            |   26 |    3 |

*From the table we can indicate that the top three most popular items
for “packaged vegetables fruits” are `Organic Baby Spinach`,
`Organic Raspberries`, and `Organic Blueberries`.The top three most
popular items for “baking ingredients” are `Light Brown Sugar`,
`Pure Baking Soda`, and `Cane Sugar`. The top three most popular items
for “dog food care” are `Snack Sticks Chicken & Rice Recipe Dog Treats`,
`Organix Chicken & Brown Rice Recipe`, and `Small Dog Biscuits`.*

Next we’ll create a table showing the mean hour of orders in each
weekday for “Pink Lady Apples” and “Coffee Ice Cream”. We can first
`filter` and `group by` product name and order dow and then `summarize`
the mean order hour for each weekday. Since we want to create a 2\*7
table, we can use `pivot_wider` to change the spread of data.

``` r
instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarize(mean_order_hour = mean(order_hour_of_day)) %>%
  pivot_wider(names_from = "order_dow", values_from = "mean_order_hour") %>%
  knitr::kable(digits = 2)
```

    ## `summarise()` has grouped output by 'product_name'. You can override using the
    ## `.groups` argument.

| product_name     |     0 |     1 |     2 |     3 |     4 |     5 |     6 |
|:-----------------|------:|------:|------:|------:|------:|------:|------:|
| Coffee Ice Cream | 13.77 | 14.32 | 15.38 | 15.32 | 15.22 | 12.26 | 13.83 |
| Pink Lady Apples | 13.44 | 11.36 | 11.70 | 14.25 | 11.55 | 12.78 | 11.94 |

*This result table infers that Pink Lady Apples are generally purchased
slightly earlier in the day than Coffee Ice Cream, with the exception of
day 5.*
